# dnsmasq --no-daemon --log-queries

# Don't function as a DNS server:
port=0

# Log lots of extra information about DHCP transactions.
log-dhcp


# set tag "ipxe" if request comes from iPXE ("iPXE" user class)
#dhcp-userclass=set:ipxe,iPXE
# alternative way, look for option 175
dhcp-match=set:ipxe,175

# UEFI
# efi32
dhcp-match=set:efi32,option:client-arch,6 # not required but provides additional information
dhcp-match=set:efi,option:client-arch,6
# efi_bc
dhcp-match=set:efibc,option:client-arch,7 # not required but provides additional information
dhcp-match=set:efi,option:client-arch,7
# efi64
dhcp-match=set:efi64,option:client-arch,9 # not required but provides additional information
dhcp-match=set:efi,option:client-arch,9
# old # inspect the vendor class string and match the text to set the tag
#dhcp-vendorclass=BIOS,PXEClient:Arch:00000
#dhcp-vendorclass=UEFI32,PXEClient:Arch:00006
dhcp-vendorclass=UEFI,PXEClient:Arch:00007
#dhcp-vendorclass=UEFI64,PXEClient:Arch:00009


# Disable re-use of the DHCP servername and filename fields as extra
# option space. That's to avoid confusing some old or broken DHCP clients.
dhcp-no-override

dhcp-range=192.168.1.0,proxy                    # set subnet


# if request comes from dumb firmware, send them iPXE (via TFTP)
dhcp-boot=tag:!ipxe,tag:!efi,ipxe/undionly.kpxe,0.0.0.0
# if requrest comes from efi firmware, send ipxe.efi (via TFTP)
dhcp-boot=tag:!ipxe,tag:efi,ipxe/ipxe.efi,0.0.0.0
# if request comes from iPXE, direct it to boot from boot.txt (bootmenu)
dhcp-boot=tag:ipxe,ipxe/boot.ipxe


# PXE menu.  The first part is the text displayed to the user.  The second is the timeout, in seconds.
#pxe-prompt="Booting from network", 5
# The known types are x86PC, PC98, IA64_EFI, Alpha, Arc_x86,
# Intel_Lean_Client, IA32_EFI, BC_EFI, Xscale_EFI and X86-64_EFI
# This option is first and will be the default if there is no input from the user.
#pxe-service=X86PC, "Boot to BIOS", bios/pxelinux.0
#pxe-service=X86-64_EFI, "Boot to BIOS UEFI", ipxe/ipxe.efi
#pxe-service=BC_EFI, "Boot to BIOS UEFI PXE-BC", ipxe/ipxe.efi


# Enable dnsmasq's built-in TFTP server
enable-tftp
# Set the root directory for files available via TFTP.
tftp-root=/container

# Do not abort if the tftp-root is unavailable
#tftp-no-fail

# Make the TFTP server more secure: with this set, only files owned by
# the user dnsmasq is running as will be send over the net.
#tftp-secure

# This option stops dnsmasq from negotiating a larger blocksize for TFTP
# transfers. It will slow things down, but may rescue some broken TFTP
# clients.
#tftp-no-blocksize